#!/bin/bash

echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Ä—Ç 3000..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Å–ª—É—à–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 3000
if sudo netstat -tlnp | grep :3000; then
    echo "‚ö†Ô∏è –ü–æ—Ä—Ç 3000 –∑–∞–Ω—è—Ç. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–∞–ø—É—â–µ–Ω–æ..."
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ PID –ø—Ä–æ—Ü–µ—Å—Å–∞ –Ω–∞ –ø–æ—Ä—Ç—É 3000
    PID=$(sudo netstat -tlnp | grep :3000 | awk '{print $7}' | cut -d'/' -f1)
    
    if [ ! -z "$PID" ]; then
        echo "üìã –ü—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É 3000 (PID: $PID):"
        ps -p $PID -o pid,ppid,cmd
        
        echo ""
        echo "‚ùì –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å –ø—Ä–æ—Ü–µ—Å—Å–æ–º –Ω–∞ –ø–æ—Ä—Ç—É 3000?"
        echo "1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)"
        echo "2. –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –¥—Ä—É–≥–æ–π"
        echo "3. –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É"
        
        read -p "–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç (1-3): " choice
        
        case $choice in
            1)
                echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å $PID..."
                sudo kill $PID
                sleep 2
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å
                if sudo netstat -tlnp | grep :3000; then
                    echo "‚ö†Ô∏è –ü—Ä–æ—Ü–µ—Å—Å –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞..."
                    sudo kill -9 $PID
                fi
                
                echo "‚úÖ –ü–æ—Ä—Ç 3000 –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω"
                ;;
            2)
                echo "üìù –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—Ç–∞ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ ecosystem.config.js"
                echo "–ò–∑–º–µ–Ω–∏—Ç–µ PORT: 3000 –Ω–∞ –¥—Ä—É–≥–æ–π –ø–æ—Ä—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5000)"
                exit 1
                ;;
            3)
                echo "‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ—Ä—Ç–∞"
                ;;
            *)
                echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä"
                exit 1
                ;;
        esac
    fi
else
    echo "‚úÖ –ü–æ—Ä—Ç 3000 —Å–≤–æ–±–æ–¥–µ–Ω"
fi

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

