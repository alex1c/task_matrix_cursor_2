# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ SQLite3 –≤ Docker

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:

```
Error: Error loading shared library /app/backend/node_modules/sqlite3/build/Release/node_sqlite3.node: Exec format error
```

## üîç –ü—Ä–∏—á–∏–Ω–∞

–û—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –∏–∑-–∑–∞ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–∏ —Å–±–æ—Ä–∫–µ SQLite3:

-   SQLite3 —Å–æ–±–∏—Ä–∞–ª—Å—è –¥–ª—è –æ–¥–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, x86_64)
-   –ó–∞–ø—É—Å–∫–∞–ª—Å—è –Ω–∞ –¥—Ä—É–≥–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ARM64)
-   –≠—Ç–æ —Ç–∏–ø–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ prebuilt –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π Dockerfile**

```dockerfile
# –≠—Ç–∞–ø 2: –°–±–æ—Ä–∫–∞ –±—ç–∫–µ–Ω–¥–∞
FROM node:18-alpine AS backend-builder

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Å–±–æ—Ä–∫–∏ –Ω–∞—Ç–∏–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
RUN apk add --no-cache \
    python3 \
    py3-setuptools \
    make \
    g++ \
    sqlite-dev \
    && rm -rf /var/cache/apk/*

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
WORKDIR /app/backend

# –ö–æ–ø–∏—Ä—É–µ–º package.json –∏ package-lock.json
COPY backend/package*.json ./

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å prebuilt –±–∏–Ω–∞—Ä–Ω–∏–∫–∞–º–∏
RUN npm ci --only=production

# –ö–æ–ø–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –±—ç–∫–µ–Ω–¥–∞
COPY backend/ ./
```

### 2. **–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è**

-   ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω `py3-setuptools`** - –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ distutils
-   ‚úÖ **–£–±—Ä–∞–Ω–∞ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ SQLite3** - –∏—Å–ø–æ–ª—å–∑—É–µ–º prebuilt –±–∏–Ω–∞—Ä–Ω–∏–∫–∏
-   ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω—ã —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** - –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

### 3. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è**

#### –í–∞—Ä–∏–∞–Ω—Ç A: Dockerfile.alternative

```dockerfile
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É SQLite3
RUN npm install sqlite3@5.1.6 --build-from-source=sqlite3
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: Dockerfile.better-sqlite3

```dockerfile
# –ó–∞–º–µ–Ω—è–µ—Ç sqlite3 –Ω–∞ better-sqlite3
"dependencies": {
  "better-sqlite3": "^9.2.2"
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
# –°–±–æ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞
docker build -t eisenhower-matrix:fixed .

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run -d -p 3000:3000 --name eisenhower-fixed eisenhower-matrix:fixed

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker logs eisenhower-fixed

# –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
# Server is running on port 3000
# Connected to SQLite database
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

```bash
# –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
./test-docker-builds.sh
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

| –ü–∞—Ä–∞–º–µ—Ç—Ä          | –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è       | –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
| ----------------- | -------------------- | ----------------- |
| **–°–±–æ—Ä–∫–∞**        | ‚ùå –û—à–∏–±–∫–∞            | ‚úÖ –£—Å–ø–µ—à–Ω–æ        |
| **–ó–∞–ø—É—Å–∫**        | ‚ùå Exec format error | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç       |
| **SQLite3**       | ‚ùå –ù–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è    | ‚úÖ –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è   |
| **–†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞** | -                    | ~150MB            |

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫:

```bash
docker run -d -p 3000:3000 --name my-app eisenhower-matrix:latest
```

### –° Docker Compose:

```bash
docker-compose up -d
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:

```bash
./docker-deploy.sh
```

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –î–ª—è —Ä–∞–∑–Ω—ã—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä:

```bash
# –°–±–æ—Ä–∫–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
docker buildx build --platform linux/amd64 -t eisenhower-matrix:amd64 .
docker buildx build --platform linux/arm64 -t eisenhower-matrix:arm64 .
```

### –î–ª—è production:

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ multi-arch –æ–±—Ä–∞–∑–∞
docker buildx build --platform linux/amd64,linux/arm64 -t eisenhower-matrix:latest .
```

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π Dockerfile** –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
2. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ü–µ–ª–µ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ** –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
3. **–†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ better-sqlite3** –¥–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ multi-arch —Å–±–æ—Ä–∫–∏** –¥–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç–∏

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É: `docker version`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker logs <container-name>`
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ Dockerfile
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–≤—Ç–æ—Ä—É: alex1c-spb@yandex.ru
